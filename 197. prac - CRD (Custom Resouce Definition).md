### 197. prac - CRD (Custom Resouce Definition)
- 커스텀 리소스 생성
	- `spec.names.plural` 는 반드시 이름의 복수형이어야 한다. 이것 때문에, 오류가 발생해서 수정하는데 오래 결렸다...
```bash
controlplane ~ ✖ vi crd.yaml 
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: internals.datasets..kodekloud.com
spec:
  group: datasets.kodekloud.com
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                internalLoad:
                  type: string
                range:
                  type: integer
                percentage:
                  type: string
  scope: Namespaced
  names:
    plural: internals
    singular: internal
    kind: Internal
    shortNames:
    - int
---

controlplane ~ ➜  k create -f crd.yaml 
customresourcedefinition.apiextensions.k8s.io/internals.datasets.kodekloud.com created
```

- 커스텀 리소스 배포
```bash
controlplane ~ ➜  cat custom.yaml 
---
kind: Internal
apiVersion: datasets.kodekloud.com/v1
metadata:
  name: internal-space
  namespace: default
spec:
  internalLoad: "high"
  range: 80
  percentage: "50"

controlplane ~ ➜  k apply -f custom.yaml 
internal.datasets.kodekloud.com/internal-space created
```

- 배포돼 있는 `collectors.monitoring.controller`의 `properties` 확인
```bash
controlplane ~ ➜  k get crd
NAME                               CREATED AT
collectors.monitoring.controller   2025-08-10T15:05:04Z
globals.traffic.controller         2025-08-10T15:05:04Z
internals.datasets.kodekloud.com   2025-08-10T15:12:54Z

controlplane ~ ➜  k get crd collectors.monitoring.controller -o yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  creationTimestamp: "2025-08-10T15:05:04Z"
  generation: 1
  name: collectors.monitoring.controller
  resourceVersion: "881"
  uid: d44df56d-c4af-4bde-89c9-bdbbc4423395
spec:
  conversion:
    strategy: None
  group: monitoring.controller
  names:
    kind: Collector
    listKind: CollectorList
    plural: collectors
    shortNames:
    - collect
    singular: collector
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              image:
                type: string
              name:
                type: string
              replicas:
                type: integer
            type: object
        type: object
    served: true
    storage: true
status:
  acceptedNames:
    kind: Collector
    listKind: CollectorList
    plural: collectors
    shortNames:
    - collect
    singular: collector
  conditions:
  - lastTransitionTime: "2025-08-10T15:05:04Z"
    message: no conflicts found
    reason: NoConflicts
    status: "True"
    type: NamesAccepted
  - lastTransitionTime: "2025-08-10T15:05:04Z"
    message: the initial names have been accepted
    reason: InitialNamesAccepted
    status: "True"
    type: Established
  storedVersions:
  - v1
```

- `globals.traffic.controller` CRD를 확인해서, 해당하는 커스텀 리소스 `datacenter` 를 생성
```bash
controlplane ~ ➜  k get crd globals.traffic.controller -o yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  creationTimestamp: "2025-08-10T15:05:04Z"
  generation: 1
  name: globals.traffic.controller
  resourceVersion: "885"
  uid: 9c42ec71-6e88-4218-92e8-1da31a26439f
spec:
  conversion:
    strategy: None
  group: traffic.controller
  names:
    kind: Global
    listKind: GlobalList
    plural: globals
    shortNames:
    - gb
    singular: global
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              access:
                type: boolean
              dataField:
                type: integer
            type: object
        type: object
    served: true
    storage: true
status:
  acceptedNames:
    kind: Global
    listKind: GlobalList
    plural: globals
    shortNames:
    - gb
    singular: global
  conditions:
  - lastTransitionTime: "2025-08-10T15:05:04Z"
    message: no conflicts found
    reason: NoConflicts
    status: "True"
    type: NamesAccepted
  - lastTransitionTime: "2025-08-10T15:05:04Z"
    message: the initial names have been accepted
    reason: InitialNamesAccepted
    status: "True"
    type: Established
  storedVersions:
  - v1


controlplane ~ ➜  cat datacenter.yaml 
apiVersion: traffic.controller/v1
kind: Global
metadata:
  name: datacenter
spec:
  dataField: 2
  access: true


controlplane ~ ➜  k apply -f datacenter.yaml 
global.traffic.controller/datacenter created
```