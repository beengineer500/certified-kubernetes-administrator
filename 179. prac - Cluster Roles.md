### 179. prac - Cluster Roles
- 현재 클러스터의 클러스터 롤, 클러스터 롤 바인딩 확인
```bash
controlplane ~ ➜  k get clusterrole | wc -l
75

controlplane ~ ➜  k get clusterrolebindings.rbac.authorization.k8s.io | wc -l
60
```

- `cluster-admin`이 연결된 사용자/그룹
```bash
controlplane ~ ➜  k describe clusterrolebindings.rbac.authorization.k8s.io cluster-admin
Name:         cluster-admin
Labels:       kubernetes.io/bootstrapping=rbac-defaults
Annotations:  rbac.authorization.kubernetes.io/autoupdate: true
Role:
  Kind:  ClusterRole
  Name:  cluster-admin
Subjects:
  Kind   Name            Namespace
  ----   ----            ---------
  Group  system:masters 
```

- `cluster-admin`이 작업할 수 있는 리소스와 액션
```bash
controlplane ~ ➜  k describe clusterrole cluster-admin
Name:         cluster-admin
Labels:       kubernetes.io/bootstrapping=rbac-defaults
Annotations:  rbac.authorization.kubernetes.io/autoupdate: true
PolicyRule:
  Resources  Non-Resource URLs  Resource Names  Verbs
  ---------  -----------------  --------------  -----
  *.*        []                 []              [*]
             [*]                []              [*]
```

- `michlle` 사용자가  node 제어 권한을 가지도록 하는 클러스터 롤, 클러스터 롤  바인딩 생성
```bash
controlplane ~ ➜  cat node-cluster-role.yaml 
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: "true"
  labels:
    kubernetes.io/bootstrapping: rbac-defaults
  name: node-access
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - "*"

controlplane ~ ➜  cat node-cluster-rolebinding.yaml 
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: "true"
  labels:
    kubernetes.io/bootstrapping: rbac-defaults
  name: node-access
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: node-access
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: User 
  name: michelle

controlplane ~ ➜  k apply -f node-cluster-role.yaml 
clusterrole.rbac.authorization.k8s.io/node-access created

controlplane ~ ➜  k apply -f node-cluster-rolebinding.yaml 
clusterrolebinding.rbac.authorization.k8s.io/node-access created
```

- `michelle`이 `persistentvolumes, storageclasses`에 대한 제어 권한을 가지도록하는 `storage-admin` 클러스터 롤,  `mechelle-storage-admin` 클러스터 롤 바인딩을 생성
```bash
# apiGroup 확인
controlplane ~ ➜  kubectl api-resources | grep -i -e persistentvolume -e storageclass
persistentvolumeclaims              pvc          v1                                  true         PersistentVolumeClaim
persistentvolumes                   pv           v1                                  false        PersistentVolume
storageclasses                      sc           storage.k8s.io/v1                   false        StorageClass


controlplane ~ ➜  vi storage-admin-clusterRole.yaml 
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: "true"
  labels:
    kubernetes.io/bootstrapping: rbac-defaults
  name: storage-admin
rules:
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - "*"
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  verbs:
  - "*"
---


controlplane ~ ➜  vi storage-admin-clusterRoleBinding.yaml 
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: "true"
  labels:
    kubernetes.io/bootstrapping: rbac-defaults
  name: michelle-storage-admin
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: storage-admin
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: User
  name: michelle
---

controlplane ~ ➜  k apply -f storage-admin-clusterRole.yaml 
clusterrole.rbac.authorization.k8s.io/storage-admin created

controlplane ~ ➜  k apply -f storage-admin-clusterRoleBinding.yaml 
clusterrolebinding.rbac.authorization.k8s.io/michelle-storage-admin created
```