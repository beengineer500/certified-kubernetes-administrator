### 214. prac - StorageClass
- 스토리지 클래스 확인
```bash
controlplane ~ ➜  k get sc
NAME                   PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
local-path (default)   rancher.io/local-path   Delete          WaitForFirstConsumer   false                  4m17s
```

```bash
controlplane ~ ➜  k get sc
NAME                        PROVISIONER                     RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
local-path (default)        rancher.io/local-path           Delete          WaitForFirstConsumer   false                  4m52s
local-storage               kubernetes.io/no-provisioner    Delete          WaitForFirstConsumer   false                  29s
portworx-io-priority-high   kubernetes.io/portworx-volume   Delete          Immediate              false                  29s
```

- 동적 프로비저닝을 지원하지 않는 스토리지 클래스 식별
	- 프로비저너가 `no-provisioner`인 스토리지 클래스를 찾는다.
```bash
controlplane ~ ➜  k get sc
NAME                        PROVISIONER                     RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
local-path (default)        rancher.io/local-path           Delete          WaitForFirstConsumer   false                  5m19s
local-storage               kubernetes.io/no-provisioner    Delete          WaitForFirstConsumer   false                  56s
portworx-io-priority-high   kubernetes.io/portworx-volume   Delete          Immediate              false                  56s
```

- 다음의 조건을 만족하는 PVC 생성
	- **StorageClass**: `local-path`
	- **Access Mode**: `ReadWriteOnce`
	- **Requested Storage**: `500Mi`
```bash
controlplane ~ ➜  vi local-pvc.yaml 
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: local-pvc
spec:
  storageClassName: local-path
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 500Mi
---

controlplane ~ ➜  k apply -f local-pvc.yaml 
persistentvolumeclaim/local-pvc created
```

- PVC 상태 확인 및 설명
	- PVC가 `Pending` 상태다. 
		- PVC를 사용하는 파드가 스케쥴링되지 않아, PVC가 동작하지 않았고, PV가 생성되지 않았기 때문이다.
```bash
controlplane ~ ➜  k get pvc
NAME        STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
local-pvc   Pending                                      local-path     <unset>                 45s

controlplane ~ ➜  k get pv
No resources found

controlplane ~ ➜  k get po
No resources found in default namespace.
```

- PVC를 사용하는 파드 생성
```bash
controlplane ~ ➜  vi nginx.yaml 
---
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - image: nginx:alpine
    name: nginx
    volumeMounts:
      - name: local-pv-vol
        mountPath: /var/www/html
  volumes:
    - name: local-pv-vol
      persistentVolumeClaim:
        claimName: local-pvc
---

controlplane ~ ➜  k apply -f nginx.yaml 
pod/nginx created
```

- 스토리지 클래스 생성
```bash
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: delayed-volume-sc
provisioner: kubernetes.io/no-provisioner
volumeBindingMode: WaitForFirstConsumer
```





---

# References
-