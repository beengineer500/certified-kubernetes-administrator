### 291. Patches Intro
- Kustomize Patches는 쿠버네티스 리소스 설정을 변경할 수 있는 다른 방법을 제공한다.
- Kustomize Transformers와 달리 하나 이상의 특정 섹션을 지정하여 변경할 수 있다.
- Transformers에서 제공하는 일반적인 섹션외에 특정 섹션을 변경하려는 경우, Patches를 사용할 수 있다. 쿠버네티스 리소스의 특정 섹션을 일치시킨 다음 해당 값을 변경한다.
	- 예시) 디플로이먼트의 `replicaSet`을 변경
 - Kustomize Patches를 사용하기 위해서는 3가지를 명시해야 한다.
	 - `Operation Type` : 패치를 통해 수행할 작업을 정한다. 자주 사용하는 것은 다음의 3가지다.
		 -  add
		 - remove
		 - replace 등
	 - `Target` : 쿠버네티스 리소스의 어떤 섹션을 타깃으로 해서 패치를 적용할 지 정한다. 한 개 이상 사용 가능하다.
		 - kind
		 - Version/Group
		 - Name
		 - Namespace
		 - labelSelector
		 - AnnotationSelector
	 - `Values` : add/replace 를 수행할 때, 타깃을 어떤 값으로 추가/변경할 지 지정한다.

#### Patches 예시#1
- `api-depl.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: api
  template:
    metadata:
      labels:
        component: api
    containers:
      - name: nginx
        image: nginx
```

- `kustomization.yaml`
	- `patches.patch`  : `|-` 를 작성해야한다.
	- `patches.patch.path` : YAML 내 `target`의 경로를 명시한다.
```yaml
...

patches:
  - target:
      kind: Deployment
      name: api-deployment
    patch: |-
      - op: replace
        path: /metadata/name    
        value: web-deployment
```

#### Patches 예시#2
- `api-depl.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: api
  template:
    metadata:
      labels:
        component: api
    containers:
      - name: nginx
        image: nginx
```

- `kustomization.yaml`
```yaml
...

patches:
  - target:
      kind: Deployment
      name: api-deployment
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 5
```

#### kustomize Patches 적용 방법
- 둘 중 어느것을 사용할 지는 개인 취향이다.
1. JSON 6902
	```yaml
	patches:
	  - target:
	      kind: Deployment
	      name: api-deployment
	    patch: |-
	      - op: replace
	        path: /spec/replicas
	        value: 5
	```

2. Strategic Merge Path
	```yaml
	patches:
	  - patch: |-
	      apiVersion: apps/v1
	      kind: Deployment
	      metadata:
	        name: api-deployment
	      spec:
	        replicas: 5
	```