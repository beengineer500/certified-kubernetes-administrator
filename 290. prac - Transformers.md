### 290. prac - Transformers
- `k8s` 디렉터리 구조 확인
```bash
controlplane ~/code/k8s ➜  ls -lR
.:
total 16
drwxr-xr-x 4 root root 4096 Jul 15 12:33 db
-rw-r--r-- 1 root root  151 Jul 15 12:33 kustomization.yaml
drwxr-xr-x 2 root root 4096 Jul 15 12:33 monitoring
drwxr-xr-x 2 root root 4096 Jul 15 12:33 nginx

./db:
total 16
drwxr-xr-x 2 root root 4096 Jul 15 12:33 NoSql
drwxr-xr-x 2 root root 4096 Jul 15 12:33 Sql
-rw-r--r-- 1 root root  118 Jul 15 12:33 db-config.yaml
-rw-r--r-- 1 root root  143 Jul 15 12:33 kustomization.yaml

./db/NoSql:
total 12
-rw-r--r-- 1 root root 671 Jul 15 12:33 db-depl.yaml
-rw-r--r-- 1 root root 213 Jul 15 12:33 db-service.yaml
-rw-r--r-- 1 root root 119 Jul 15 12:33 kustomization.yaml

./db/Sql:
total 12
-rw-r--r-- 1 root root 490 Jul 15 12:33 db-depl.yaml
-rw-r--r-- 1 root root 217 Jul 15 12:33 db-service.yaml
-rw-r--r-- 1 root root 119 Jul 15 12:33 kustomization.yaml

./monitoring:
total 12
-rw-r--r-- 1 root root 317 Jul 15 12:33 grafana-depl.yaml
-rw-r--r-- 1 root root 215 Jul 15 12:33 grafana-service.yaml
-rw-r--r-- 1 root root 151 Jul 15 12:33 kustomization.yaml

./nginx:
total 12
-rw-r--r-- 1 root root 125 Jul 15 12:33 kustomization.yaml
-rw-r--r-- 1 root root 299 Jul 15 12:33 nginx-depl.yaml
-rw-r--r-- 1 root root 196 Jul 15 12:33 nginx-service.yaml
```

- `k8s/kustomization.yaml`이 참조하는 모든 리소스에 추가될 레이블 확인
```bash
controlplane ~/code/k8s ➜  cat kustomization.yaml 
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - db/
  - monitoring/
  - nginx/

commonLabels:
  sandbox: dev
```

- `db` 하위 디렉터리에 있는 리소스들에 추가될 `NamePrefix` 확인
```bash
controlplane ~/code/k8s ➜  cat db/kustomization.yaml 
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - NoSql/
  - Sql/
  - db-config.yaml

namePrefix: data-
```

- `monitoring` 하위 디렉터리에 있는 리소스들이 배포될 네임스페이스 확인
```bash
controlplane ~/code/k8s ➜  cat monitoring/kustomization.yaml 
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - grafana-depl.yaml
  - grafana-service.yaml

namespace: logging
```

- `nginx, monitoring` 하위 디렉터리에 있는 리소스들에게 다음의 annotation 추가
	- `owner: bob@gmail.com`
```bash
controlplane ~/code/k8s ➜  vi nginx/kustomization.yaml 
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - nginx-depl.yaml
  - nginx-service.yaml
    
commonAnnotations:
  owner: bob@gmail.com
---

controlplane ~/code/k8s ➜  vi monitoring/kustomization.yaml
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - grafana-depl.yaml
  - grafana-service.yaml

namespace: logging

commonAnnotations:
  owner: bob@gmail.com
---
```

- 모든 `postgres` 이미지를 `mysql` 이미지로 변경
```bash
controlplane ~/code/k8s ➜  vi kustomization.yaml 
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - db/
  - monitoring/
  - nginx/

commonLabels:
  sandbox: dev

images:
  - name: postgres
    newName: mysql
---
```

- `nginx` 디렉터리 내 리소스의 `nginx` 이미지를 `nginx:1.23`으로 변경
```bash
controlplane ~/code/k8s ➜  vi nginx/kustomization.yaml 
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - nginx-depl.yaml
  - nginx-service.yaml

commonAnnotations:
  owner: bob@gmail.com
    
images:
  - name: nginx
    newTag: "1.23"
---
```