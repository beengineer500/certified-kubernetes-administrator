---
index: "[[ğŸ· Lecture Notes]]"
tags:
  - Kubernetes
  - Kubernetes/k8s
  - Kubernetes/Drain
  - Kubernetes/Node
  - Kubernetes/Scheduling
created: 2025-05-26 09:20
status: 
source_url:
---

>[!info] Link
>- 

---

- í´ëŸ¬ìŠ¤í„° ë…¸ë“œ í™•ì¸
```bash
controlplane ~ âœ  k get no
NAME           STATUS   ROLES           AGE     VERSION
controlplane   Ready    control-plane   6m9s    v1.33.0
node01         Ready    <none>          5m30s   v1.33.0
```

- ë””í”Œë¡œì´ë¨¼íŠ¸ í™•ì¸
```bash
controlplane ~ âœ  k get deploy
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
blue   3/3     3            3           26s
```

- íŒŒë“œ ë°°í¬ ë…¸ë“œ í™•ì¸
```bash
controlplane ~ âœ  k get po -o wide
NAME                    READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES
blue-69968556cc-4fmrb   1/1     Running   0          65s   172.17.1.2   node01         <none>           <none>
blue-69968556cc-5smnv   1/1     Running   0          65s   172.17.1.3   node01         <none>           <none>
blue-69968556cc-8df6n   1/1     Running   0          65s   172.17.0.4   controlplane   <none>           <none>
```

- `kubectl drain`ì„ í†µí•´ ë…¸ë“œì— ë°°í¬ëœ íŒŒë“œ ì¶”ì¶œ. ë…¸ë“œ ë¹„ìš°ê¸°
```bash
controlplane ~ âœ  k drain node01 --ignore-daemonsets
node/node01 cordoned
Warning: ignoring DaemonSet-managed Pods: kube-flannel/kube-flannel-ds-pnz4r, kube-system/kube-proxy-kjbkv
evicting pod default/blue-69968556cc-5smnv
evicting pod default/blue-69968556cc-4fmrb
pod/blue-69968556cc-4fmrb evicted
pod/blue-69968556cc-5smnv evicted
node/node01 drained

```

- `node01`ì— ë°°í¬ëì—ˆë˜ íŒŒë“œë“¤ì´ `controlplane`ìœ¼ë¡œ ì˜®ê²¨ì§„ ê²ƒì„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.
```bash
controlplane ~ âœ  k get po -o wide
NAME                    READY   STATUS    RESTARTS   AGE     IP           NODE           NOMINATED NODE   READINESS GATES
blue-69968556cc-8df6n   1/1     Running   0          4m29s   172.17.0.4   controlplane   <none>           <none>
blue-69968556cc-bdbl7   1/1     Running   0          27s     172.17.0.6   controlplane   <none>           <none>
blue-69968556cc-jqqgc   1/1     Running   0          27s     172.17.0.5   controlplane   <none>           <none>
```

- `kubectl uncordon`ì„ í†µí•´ `node01`ì„ ë‹¤ì‹œ ìŠ¤ì¼€ì¥´ë§ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½
	- `node01`ì„ ìŠ¤ì¼€ì¥´ë§ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½í•˜ë”ë¼ë„, `controlplane`ìœ¼ë¡œ ì˜®ê²¨ê°”ë˜ íŒŒë“œë“¤ì´ ìë™ìœ¼ë¡œ `node01`ë¡œ ëŒì•„ì˜¤ì§€ëŠ” ì•ŠëŠ”ë‹¤.
```bash
controlplane ~ âœ  kubectl uncordon node01
node/node01 uncordoned


controlplane ~ âœ  kubectl get po -o wide
NAME                    READY   STATUS    RESTARTS   AGE     IP           NODE           NOMINATED NODE   READINESS GATES
blue-69968556cc-8df6n   1/1     Running   0          8m25s   172.17.0.4   controlplane   <none>           <none>
blue-69968556cc-bdbl7   1/1     Running   0          4m23s   172.17.0.6   controlplane   <none>           <none>
blue-69968556cc-jqqgc   1/1     Running   0          4m23s   172.17.0.5   controlplane   <none>           <none>
```

- `node01`ì„ ë‹¤ì‹œ `drain`
	- í•˜ì§€ë§Œ ì‹¤íŒ¨í•œë‹¤. 
		- `kubectl get po -o wide`ë¥¼ í†µí•´ íŒŒë“œë“¤ì„ í™•ì¸í•´ë³´ë©´, ë ˆí”Œë¦¬ì¹´ì…‹ì— ì˜í•´ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ” ì‹±ê¸€ íŒŒë“œ `hr-app` íŒŒë“œê°€ ì¡´ì¬í•œë‹¤.  ì´ëŸ° ê²½ìš°, `kubectl drain`ì€ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤. ê°•ì œë¡œ `drain` í•˜ê¸° ìœ„í•´ì„œëŠ” `kubectl drain --force` ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
```bash
controlplane ~ âœ  kubectl drain node01 --ignore-daemonsets
node/node01 cordoned
error: unable to drain node "node01" due to error: cannot delete cannot delete Pods that declare no controller (use --force to override): default/hr-app, continuing command...
There are pending nodes to be drained:
 node01
cannot delete cannot delete Pods that declare no controller (use --force to override): default/hr-app

controlplane ~ âœ– k get po -o wide
NAME                    READY   STATUS    RESTARTS   AGE     IP           NODE           NOMINATED NODE   READINESS GATES
blue-69968556cc-bx7wq   1/1     Running   0          3m19s   172.17.0.4   controlplane   <none>           <none>
blue-69968556cc-wdsrb   1/1     Running   0          2m50s   172.17.0.6   controlplane   <none>           <none>
blue-69968556cc-zxpd2   1/1     Running   0          2m50s   172.17.0.5   controlplane   <none>           <none>
hr-app                  1/1     Running   0          53s     172.17.1.4   node01         <none>           <none>
```

- `kubectl drain --force --ignore-daemonsets`
	- ê°•ì œ `drain`í•  ê²½ìš°, ë ˆí”Œë¦¬ì¹´ì…‹ì— ì˜í•´ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ” íŒŒë“œëŠ” ì‚­ì œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```bash
controlplane ~ âœ  k drain node01 --force --ignore-daemonsets
node/node01 already cordoned
Warning: deleting Pods that declare no controller: default/hr-app; ignoring DaemonSet-managed Pods: kube-flannel/kube-flannel-ds-w4v6f, kube-system/kube-proxy-hq9nh
evicting pod default/hr-app
pod/hr-app evicted
node/node01 drained

controlplane ~ âœ  k get po
NAME                    READY   STATUS    RESTARTS   AGE
blue-69968556cc-bx7wq   1/1     Running   0          8m29s
blue-69968556cc-wdsrb   1/1     Running   0          8m
blue-69968556cc-zxpd2   1/1     Running   0          8m
```

- `hr-app` ë³µêµ¬ëœ ë’¤, `kubectl cordon`ì„ í†µí•´ `node01`ë¥¼ ìŠ¤ì¼€ì¥´ë§ ì•ˆë˜ë„ë¡ ì„¤ì •
	- `kubectl cordon`ëŠ” ê¸°ì¡´ì˜ íŒŒë“œë“¤ì€ ê·¸ëŒ€ë¡œ ë™ì‘í•˜ê³ , ì•ìœ¼ë¡œ ìƒˆë¡œìš´ íŒŒë“œê°€ `node01`ì— ìŠ¤ì¼€ì¥´ë§ë˜ì§€ ì•Šë„ë¡ í•œë‹¤.
```bash
controlplane ~ âœ  k get po
NAME                    READY   STATUS    RESTARTS   AGE
blue-69968556cc-bx7wq   1/1     Running   0          10m
blue-69968556cc-wdsrb   1/1     Running   0          9m32s
blue-69968556cc-zxpd2   1/1     Running   0          9m32s
hr-app-79c459cc-mmqn9   1/1     Running   0          54s



```