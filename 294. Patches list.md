### 294. Patches list
#### Patche 예시 - Json 6902 (컨테이너 이미지 replace)
- `api-depl.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: api
  template:
    metadata:
      labels:
        component: api
    containers:
      - name: nginx
        image: nginx
```

- `kustomization.yaml`
	- `spec.template.containers` 섹션은 배열이다. 따라서 첫번째 인덱스는 0이다.
```yaml
patches:
  - target:
      kind: Deployment
      name: api-deployment
  patch: |-
    - op: replace
      path: /spec/template/containers/0
      value:
        name: haproxy
        value: haproxy
```

#### Patches 예시 - Strategic Merge Patch (컨테이너 이미지 replace)
- `api-depl.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: api
  template:
    metadata:
      labels:
        component: api
    containers:
      - name: nginx
        image: nginx
```

- `kustomization.yaml`
```yaml
patches:
  - label-patch.yaml
```

- `label-patch.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  template:
    containers:
      - name: nginx
        image: haproxy
```

#### Patche 예시 - Json 6902 (컨테이너 add)
- `api-depl.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: api
  template:
    metadata:
      labels:
        component: api
    containers:
      - name: nginx
        image: nginx
```

- `kustomization.yaml`
	- `path: /spec/template/containers/-`
		- `-` 은 마지막에 추가하겠다는 의미이다.
		- 0, 1 등 인덱스를 지정해서 추가하는 것도 가능하다.
```yaml
patches:
  - target:
      kind: Deployment
      name: api-deployment
  patch: |-
    - op: add
      path: /spec/template/containers/-
      value:
        name: haproxy
        value: haproxy
```

#### Patches 예시 - Strategic Merge Patch (컨테이너 이미지 add)
- `api-depl.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: api
  template:
    metadata:
      labels:
        component: api
    containers:
      - name: nginx
        image: nginx
```

- `kustomization.yaml`
```yaml
patches:
  - label-patch.yaml
```

- `label-patch.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  template:
    containers:
      - name: haproxy
        image: haproxy
```

#### Patche 예시 - Json 6902 (컨테이너 remove)
- `api-depl.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: api
  template:
    metadata:
      labels:
        component: api
    containers:
      - name: web
        image: nginx
      - name: database
        image: mongo
```

- `kustomization.yaml`
```yaml
patches:
  - target:
      kind: Deployment
      name: api-deployment
  patch: |-
    - op: remove
      path: /spec/template/containers/1
```

#### Patches 예시 - Strategic Merge Patch (컨테이너 이미지 remove)
- `api-depl.yaml`
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: api
  template:
    metadata:
      labels:
        component: api
    containers:
      - name: web
        image: nginx
      - name: database
        image: mongo
```

- `kustomization.yaml`
```yaml
patches:
  - label-patch.yaml
```

- `label-patch.yaml`
	- 특정 섹션을 삭제하고 싶다는 표시를 `$patch: delete`로 지시한다.
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  template:
    containers:
      - $patch: delete
        name: database
```