---
index: "[[ğŸ· Lecture Notes]]"
tags:
  - Kubernetes
  - Kubernetes/k8s
  - Kubernetes/Storage
  - Kubernetes/PVC
  - Kubernetes/PV
created: 2025-05-26 09:20
status: 
source_url:
---
>[!info] Link
>- 

---

### 209. prac - Persistent Volumes and Persistent Volume Claims
- íŒŒë“œ í™•ì¸
```bash
controlplane ~ âœ  k get po
NAME     READY   STATUS    RESTARTS   AGE
webapp   1/1     Running   0          13s
```

- íŒŒë“œì˜ ë¡œê·¸ í™•ì¸
```bash
controlplane ~ âœ  k exec webapp -- cat /log/app.log
...
[2025-07-24 14:03:19,296] WARNING in event-simulator: USER5 Failed to Login as the account is locked due to MANY FAILED ATTEMPTS.
...
```

- í˜¸ìŠ¤íŠ¸ ê²½ë¡œ ë³¼ë¥¨ì„ ì‚¬ìš©í•˜ëŠ” íŒŒë“œ ìƒì„±
```bash
controlplane ~ âœ  k run webapp --dry-run=client \
> --image=kodekloud/event-simulator \
> -o yaml >> pod-webapp.yaml

controlplane ~ âœ  vi pod-webapp.yaml 
---
apiVersion: v1
kind: Pod
metadata:
  labels:
    name: webapp
  name: webapp
spec:
  containers:
  - image: kodekloud/event-simulator
    name: webapp
    volumeMounts:
    - mountPath: /log
      name: host-volume
  dnsPolicy: ClusterFirst
  restartPolicy: Always
  volumes:
  - name: host-volume
    hostPath:
      path: /var/log/webapp
      type: Directory
---

controlplane ~ âœ  k apply -f pod-webapp.yaml 
pod/webapp created

controlplane ~ âœ  k get po
NAME     READY   STATUS    RESTARTS   AGE
webapp   1/1     Running   0          76s
```

- PV ìƒì„±
```bash
controlplane ~ âœ  vi pv.yaml
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-log
  labels:
    name: pv-log
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  capacity:
    storage: 100Mi
  hostPath:
    path: /pv/log
---

controlplane ~ âœ  k apply -f pv.yaml 
persistentvolume/pv-log created

controlplane ~ âœ  k get pv
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-log   100Mi      RWX            Retain           Available                          <unset>                          5s
```

- pvc ìƒì„±
```bash
controlplane ~ âœ  vi pvc.yaml
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: claim-log-1
  labels:
    name: claim-log-1
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 50Mi
---

controlplane ~ âœ  k apply -f pvc.yaml 
persistentvolumeclaim/claim-log-1 created


controlplane ~ âœ  k get pvc
NAME          STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
claim-log-1   Pending                                                     <unset>                 69s
```

- ìƒì„±í•œ pv - pvcê°€ ë°”ì¸ë”©ë˜ì§€ ì•Šê³ ìˆë‹¤. ì´ìœ ëŠ” `accessModes`ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì´ë‹¤.
- pvcë¥¼ ì‚­ì œí•˜ê³  `accessModes`ë¥¼ ìˆ˜ì •í•´ì„œ ë‹¤ì‹œ ìƒì„±
```bash
controlplane ~ âœ  k delete -f pvc.yaml 
persistentvolumeclaim "claim-log-1" deleted


controlplane ~ âœ  vi pvc.yaml 
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: claim-log-1
  labels:
    name: claim-log-1
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 50Mi
---


controlplane ~ âœ  k apply -f pvc.yaml 
persistentvolumeclaim/claim-log-1 created


controlplane ~ âœ  k get pvc
NAME          STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
claim-log-1   Bound    pv-log   100Mi      RWX                           <unset>                 3s


controlplane ~ âœ  k get pv
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                 STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-log   100Mi      RWX            Retain           Bound    default/claim-log-1                  <unset>                          14m

```

- pvcë¥¼ ì‚¬ìš©í•˜ëŠ” pod ìƒì„±
```bash
controlplane ~ âœ  vi pod-webapp2.yaml 
---
apiVersion: v1
kind: Pod
metadata:
  labels:
    name: webapp
  name: webapp
spec:
  containers:
  - image: kodekloud/event-simulator
    name: webapp
    volumeMounts:
    - mountPath: /log
      name: log-volume
  dnsPolicy: ClusterFirst
  restartPolicy: Always
  volumes:
  - name: log-volume
    persistentVolumeClaim:
      claimName: claim-log-1
---


controlplane ~ âœ  k apply -f pod-webapp2.yaml 
pod/webapp created


controlplane ~ âœ  k get po
NAME     READY   STATUS    RESTARTS   AGE
webapp   1/1     Running   0          2s

```


- PVì˜ `persistentVolumeReclaimPolicy: Retain` ì„¤ì •ì€ ë°”ì¸ë”© ë¼ìˆë˜ PVCê°€ ì‚­ì œë˜ë”ë¼ë„ PVëŠ” ì‚­ì œë˜ì§€ ì•Šê³  ë‚¨ì•„ìˆê²Œ í•œë‹¤. í•˜ì§€ë§Œ ì‚¬ìš©ì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

- PVCë¥¼ ì‚¬ìš© ì¤‘ì¸ íŒŒë“œê°€ ìˆì„ ê²½ìš°, pvdë¥¼ ì‚­ì œí•˜ë ¤ê³  í•´ë„ ì‚­ì œë˜ì§€ ì•ŠëŠ”ë‹¤. ëª…ë ¹ì´ hang ìƒíƒœê°€ ê±¸ë¦°ë‹¤.
```bash
controlplane ~ âœ  k delete pvc claim-log-1 
persistentvolumeclaim "claim-log-1" deleted
^C
```

- PVCë¥¼ ì‚¬ìš© ì¤‘ì¸ íŒŒë“œê°€ ì‚­ì œëœë‹¤ë©´, PVC ì‚­ì œ ëª…ë ¹ì€ ì´ì–´ì„œ ë°”ë¡œ ë™ì‘í•˜ì—¬ PVCë¥¼ ì‚­ì œí•œë‹¤.
```bash
controlplane ~ âœ– k delete po webapp 
pod "webapp" deleted

controlplane ~ âœ  k get pvc
No resources found in default namespace.
```

- PVëŠ” `Retain` ì„¤ì •ì´ ë¼ìˆì–´ì„œ, PVCê°€ ì‚­ì œë˜ë”ë¼ë„ `Released` ìƒíƒœë¡œ ë‚¨ì•„ìˆëŠ”ë‹¤.
```bash
controlplane ~ âœ  k get pv
NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS     CLAIM                 STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pv-log   100Mi      RWX            Retain           Released   default/claim-log-1                  <unset>                          28m
```




---

# References
- 