### 187. Pre-requisite - Security in Docker
- 도커 컨테이너가 실행되는 호스트 서버에서, 컨테이너는 호스트와 커널을 공유한다. 
- 컨테이너는 linux의 네임스페이스를 사용하여 격리된다.
- 컨테이너는 호스트의 네임스페이스에서 실행된다. 하지만 컨테이너 내부는 자체 네임스페이스를 가지고 있다. 따라서, 컨테이너 내부와 외부는 네임스페이스로 격리돼 있다.

- 도커 이미지 빌드 시 지정한 CMD 필드의 작업을 수행할 경우, 기본적으로 컨테이너 내부에서 root t사용자로로 실행된다.
- 명령을 실행할 사용자를 root 외에 다른 사용자로 변경할 수 있다.
```bash
docker run --user=1000 ubuntu sleep 3600
```

- 이를 활용 보안을 위해, 도커 이미지 빌드 시부터  CMD 필드를 수행할 사용자를 root 외의 사용자로 지정할 수 있다.
```bash
# Dockerfile
---
FROM ubuntu

...

USER 1000
---

> docker build -t my-ubuntu-image .
```

- 도커 컨테이너 내부의 Root 사용자는 호스트 서버의 Root와 다르다. 따라서, 컨테이너 내부 Root 사용자가 컨테이너 외부 호스트 서버에 대해 Root 권한을 행세할 수 없다.
- 도커는 이를 Linux 기능을 사용하여 구현한다. Linux 내에는 수행 가능한 작업에 대한 기능 세트 목록이 존재한다.
	- 기능 세트 목록은 `/usr/include/linux/capability.h` 에서 확인 가능하다.
- 도커는 기능 세트 중 일부만을 가지고 컨테이너를 실행한다. 컨테이너는 해당하는 기능만 사용할 수 있다.
- 도커 컨테이너 실행 시, 기능 세트를 추가하고 제거할 수 있다.
```bash
docker run --cap-add MAC_ADMIN ubuntu

docker run --cap-drop KILL ubuntu

# 모든 권한 활성화 플래그 사용
docker run --privileged ubuntu
```




---

# References
-