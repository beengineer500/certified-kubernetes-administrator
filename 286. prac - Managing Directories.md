### 286. prac - Managing Directories
- `k8s` 디렉터리의 하위 디렉터리 확인
```bash
controlplane ~/code/k8s ➜  ll
total 20
drwxr-xr-x 5 root root 4096 Aug 17 04:13 ./
drwxr-xr-x 1 root root 4096 Aug 17 04:13 ../
drwxr-xr-x 2 root root 4096 Aug 17 04:13 db/
drwxr-xr-x 2 root root 4096 Aug 17 04:13 message-broker/
drwxr-xr-x 2 root root 4096 Aug 17 04:13 nginx/
```

- k8s 디렉터리에 `kustomization.yaml` 작성 및 배포
```bash
controlplane ~/code/k8s ✖ vi kustomization.yaml
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - db/db-config.yaml
  - db/db-depl.yaml
  - db/db-service.yaml
  - message-broker/rabbitmq-config.yaml
  - message-broker/rabbitmq-depl.yaml
  - message-broker/rabbitmq-service.yaml
  - nginx/nginx-depl.yaml
  - nginx/nginx-service.yaml
---

controlplane ~/code/k8s ➜  kubectl apply -k .
configmap/db-credentials created
configmap/redis-credentials created
service/db-service created
service/nginx-service created
service/rabbit-cluster-ip-service created
deployment.apps/db-deployment created
deployment.apps/nginx-deployment created
deployment.apps/rabbitmq-deployment created
```

- 배포된 파드 및 서비스 유형 확인
```bash
controlplane ~/code/k8s ➜  k get po
NAME                                   READY   STATUS    RESTARTS   AGE
db-deployment-7c4b7b54bf-62kgl         1/1     Running   0          6m44s
nginx-deployment-69ff98dbb7-5j27f      1/1     Running   0          6m44s
nginx-deployment-69ff98dbb7-hd7xb      1/1     Running   0          6m44s
nginx-deployment-69ff98dbb7-xxsxc      1/1     Running   0          6m44s
rabbitmq-deployment-6fbd45d675-gvq7d   1/1     Running   0          6m44s

controlplane ~/code/k8s ➜  k get svc
NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)           AGE
db-service                  NodePort    172.20.43.19    <none>        27017:30219/TCP   7m26s
kubernetes                  ClusterIP   172.20.0.1      <none>        443/TCP           33m
nginx-service               NodePort    172.20.8.222    <none>        80:32127/TCP      7m26s
rabbit-cluster-ip-service   ClusterIP   172.20.135.27   <none>        5672/TCP          7m26s
```

- 각 하위 디렉터리 별로 `kustomization.yaml` 작성 및 배포
```yaml
# k8s
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - db/
  - message-broker/
  - nginx/
```

```yaml
# db
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - db-config.yaml
  - db-depl.yaml
  - db-service.yaml
```

```yaml
# message-broker
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - rabbitmq-config.yaml
  - rabbitmq-depl.yaml
  - rabbitmq-service.yaml
```

```yaml
# nginx
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - nginx-depl.yaml
  - nginx-service.yaml
```

- 배포
```bash
controlplane ~/code/k8s ➜  kubectl apply -k .
configmap/db-credentials created
configmap/redis-credentials created
service/db-service created
service/nginx-service created
service/rabbit-cluster-ip-service created
deployment.apps/db-deployment created
deployment.apps/nginx-deployment created
deployment.apps/rabbitmq-deployment created
```

- 배포된 파드 개수 확인
```bash
controlplane ~/code/k8s ➜  k get po
NAME                                   READY   STATUS    RESTARTS   AGE
db-deployment-7c4b7b54bf-bc9cr         1/1     Running   0          28s
nginx-deployment-69ff98dbb7-29p52      1/1     Running   0          28s
nginx-deployment-69ff98dbb7-fdfnt      1/1     Running   0          28s
nginx-deployment-69ff98dbb7-wcpsr      1/1     Running   0          28s
rabbitmq-deployment-6fbd45d675-2jjzq   1/1     Running   0          28s
rabbitmq-deployment-6fbd45d675-tglgw   1/1     Running   0          28s
```