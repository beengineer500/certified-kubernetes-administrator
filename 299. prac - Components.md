### 299. prac - Components
- `community` 오버레이에서 사용할 수 있는 컴포넌트 확인
```bash
controlplane ~/code/project_mercury ➜  cat overlays/community/kustomization.yaml 
bases:
  - ../../base

components:
  - ../../components/auth
```

- `dev` 오버레이에서 사용할 수 있는 컴포넌트 확인
```bash
controlplane ~/code/project_mercury ✖ cat overlays/dev/kustomization.yaml 
bases:
  - ../../base

components:
  - ../../components/auth
  - ../../components/db
  - ../../components/logging
```

- `db` 컴포넌트가 `api-deployment`를 배포할 때 사용하는 환경변수 개수
```bash
controlplane ~/code/project_mercury ➜  cat components/db/api-patch.yaml 
...
          env:
            - name: DB_CONNECTION
              value: postgres-service
            - name: DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: db-creds
                  key: password
```

- `db` 컴포넌트에서 `secretGenerator`의 이름 확인
```bash
controlplane project_mercury/components/db ➜  cat kustomization.yaml 
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

resources:
  - db-deployment.yaml
  - db-service.yaml

secretGenerator:
  - name: db-creds
    literals:
      - password=password1

patches:
  - path: api-patch.yaml
```

- `community` 오버레이에 `logging` 컴포넌트를 추가 후 배포
```bash
controlplane project_mercury/overlays/community ➜  vi kustomization.yaml 
---
bases:
  - ../../base

components:
  - ../../components/auth
  - ../../components/logging
---

controlplane project_mercury/overlays/community ➜  k apply -k .
# Warning: 'bases' is deprecated. Please use 'resources' instead. Run 'kustomize edit fix' to update your Kustomization automatically.
service/api-service created
service/keycloak-service created
service/prometheus-service created
deployment.apps/api-deployment created
deployment.apps/keycloak-deployment created
deployment.apps/prometheus-deployment created
```

- `caching` 컴포넌트에 `redis-depl.yaml, redis-service.yaml`리소스를 가지는 `kustomization.yaml` 을 작성
```bash
controlplane code/project_mercury/components ➜  vi kustomization.yaml 
---
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

resources:
  - redis-depl.yaml
  - redis-service.yaml
---
```

- `caching` 컴포넌트에서 Base의 `api-deployment` 에 환경변수를 추가하는 patch를 추가
```bash
controlplane project_mercury/components/caching ➜  cat api-patch.yaml 
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-deployment
spec:
  template:
    spec:
      containers:
        - name: api
          env:
            - name: REDIS_CONNECTION
              value: redis-service

controlplane project_mercury/components/caching ➜  cat kustomization.yaml 
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

resources:
  - redis-depl.yaml
  - redis-service.yaml

patches:
  - path: api-patch.yaml
```

- `caching` 컴포넌트를 `enterprise` 환경에서 호출하도록 설정 및 배포
```bash
controlplane project_mercury/overlays/enterprise ➜  vi kustomization.yaml 
---
bases:
  - ../../base

components:
  - ../../components/auth
  - ../../components/db
  - ../../components/caching
---

controlplane project_mercury/overlays/enterprise ➜  k apply -k .
# Warning: 'bases' is deprecated. Please use 'resources' instead. Run 'kustomize edit fix' to update your Kustomization automatically.
secret/db-creds-dd6525th4g created
service/api-service unchanged
service/keycloak-service unchanged
service/postgres-service created
service/redis-service created
deployment.apps/api-deployment configured
deployment.apps/keycloak-deployment unchanged
deployment.apps/postgres-deployment created
deployment.apps/redis-deployment created
```