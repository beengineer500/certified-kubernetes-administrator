### 298. Components
- 컴포넌트는 resources + patches로 구성된 재사용 가능한 블록이다. 오버레이 하위의 환경별로 특정 구성을 재사용할 수 있다.
- 컴포넌트들은 `base, overlays` 디렉터리와 동일한 레이어에 `components` 디렉터리 내부에 위치한다.
- 환경 별로 특정 컴포넌트가 필요하면, 호출해서 사용하는 방식으로 구성(매니페스트) 블록을 재사용할 수 있다.
```text
k8s
├─ base/
│  ├─ kustomization.yaml
│  └─ api-depl.yaml
├─ components/
│  ├─ caching/
│  │  ├─ kustomization.yaml
│  │  ├─ deployment-patch.yaml
│  │  └─ redis-depl.yaml
│  └─ db/
│     ├─ kustomization.yaml
│     ├─ deployment-patch.yaml
│     └─ postgres-depl.yaml
└─ overlays/
   ├─ dev/
   │  └─ kustomization.yaml
   ├─ premium/
   │  └─ kustomization.yaml
   └─ standalone/
      └─ kustomization.yaml
```

- `components/db/kustomazation.yaml`
	- 컴포넌트로 사용되는 `kustomization.yaml`의 `apiVersion, kind`는 다음과 같이 설정돼야 한다.
		- `apiVersion: kustomize.config.k8s.io/v1alpha1`
		- `kind: Component`
```yaml
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

resources:
  - postres-depl.yaml

secretGenerator:
  - name: postrges-cred
    literals:
      - password=postgres123

patches:
  - deployment-patch.yaml
```

- `components/db/deployment-patch.yaml`
```yaml
apiVersoin: apps/v1
kind: Deployment
metadata:
  name: api-deploymetn
spec:
  template:
    spec:
      containers:
        - name: api
          env:
            - name: DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: postgres-cred
                  key: paassword
```

- `overlays/dev/kustomization.yaml`
	- overlay 하위 특정 환경에서 컴포넌트를 불러와 재사용하려면
	  `components` 섹션을 추가하고, 컴포넌트 매니페스트의 상대 경로를 명시해야 한다.
```bash
bases:
  - ../../base

components:
  - ../../components/db
```




---

# References
-