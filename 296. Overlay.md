### 296. Overlay
- kustomize 디렉터리 구조
	- base
		- 쿠버네티스 리소스 기본 매니페스트가 위치한다.
		- base에 위치한 매니페스트들은 모든 환경에 공유된다.
	- overlay
		- 각 환경별로 디렉터리가 나뉜다.
		- 각 환경별로 Patch를 통해서 매니페스트들을 커스터마이징 한다.
```text
k8s
├─ base/
│  ├─ kustomization.yaml
│  ├─ nginx-depl.yaml
│  ├─ service.yaml
│  └─ redis-depl.yaml
└─ overlays/
   ├─ dev/
   │  ├─ kustomization.yaml
   │  └─ config-map.yaml
   ├─ stg/
   │  ├─ kustomization.yaml
   │  └─ config-map.yaml
   └─ prod/
      ├─ kustomization.yaml
      └─ config-map.yaml
```

#### 예시
- `/base/kustomization.yaml`
```yaml
resources:
  - nginx-depl.yaml
  - service.yaml
  - reids-depl.yaml
```

- `/base/nginx-depl.yaml`
```bash
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 1
```

- `/overlays/dev/kustomization.yaml`
	- 기본 구성이 위치한 Base의 경로를 `bases` 섹션에 상대 경로로 명시한다.
```bash
bases:
  - ../../base

patch: |-
  - op: replace
    path: /spec/replicas
    value: 2
```

- `/overlays/prod/kustomization.yaml`
	- 기본 구성이 위치한 Base의 경로를 `bases` 섹션에 상대 경로로 명시한다.
```bash
bases:
  - ../../base

patch: |-
  - op: replace
    path: /spec/replicas
    value: 3
```


- base 디렉터리에 존재하는 기본 구성 외에 특정 환경에서만 추가되는 쿠버네티스 리소스/매니페스트가 존재할 수 있다. 
- 이 경우, overaly 하위 환경 디렉터리 내에서 새로운 리소스를 원하는 만큼 추가할 수 있다.
 ```text
k8s
├─ base/
│  ├─ kustomization.yaml
│  ├─ nginx-depl.yaml
│  ├─ service.yaml
│  └─ redis-depl.yaml
└─ overlays/
   ├─ dev/
   │  ├─ kustomization.yaml
   │  └─ config-map.yaml
   ├─ stg/
   │  ├─ kustomization.yaml
   │  └─ config-map.yaml
   └─ prod/
      ├─ kustomization.yaml
      ├─ config-map.yaml
      └─ grafana-depl.yaml
```

- `overlays/prod/kustomization.yaml`
```yaml
bases:
  - ../../base

resources:
  - grafana-depl.yaml

patch: |-
  - op: replace
    path: /spec/replicas
    value: 2
```