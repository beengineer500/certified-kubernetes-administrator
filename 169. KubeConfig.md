### 169. KubeConfig
- 쿠버네티스 API를 통해서 `kube-apiserver`와 상호작용하기 위해서는 사용장 인증서-키 쌍, CA 인증서가 필요하다.
```bash
curl https://my-kubernetes:6443/api/v1/pods/ \
--key admin.key \
--cert admin.crt \
--cacert ca.crt
```

- `kubectl`을 사용할 때도 동일하게 사용자 인증서-키 쌍, CA 인증서를 옵션으로 지정할 수 있다.
```bash
kubectl get pods \
--server my-kuberentes:6443 \
--key admin.key \
--cert admin.crt \
--cacert ca.crt
```

- 매 명령마다 인증서-키 쌍, CA 인증서를 옵션으로 지정하는 것은 번거로운 일이다. 이를 KubeConfig 파일에 기재함으로써 매번 지정하지 않도록 할 수 있다.

- `kubectl`은 매 실행 마다, 기본적으로 `$HOME/.kube/config` 파일을 참조한다. 여기에 인증서-키 쌍과, CA 인증서를 명시해놓으면, 매번 옵션으로 지정할 필요가 없다.

- `$HOME/.kube/config` 파일에는 3개의 섹션이 존재한다.
	- Clusters : 사용자가 접근하고 싶어하는 클러스터를 말한다.
		- Development
		- Production
		- Google
		- MyKuberentes
			- `--server my-kubernetes:6443`
			- `--cacert ca.crt`
	- Contexts : 클러스터와 사용자를 결합한다. 어떤 사용자가 어떤 클러스터에 접근할 지를 정의한다.
		- Admin@Production
		- Dev@Google
		- MyKubeAdmin@MyKubernetes
	- Users : 사용자 계정
		- Admin
		- Dev User
		- Prod User
		- MyKubeAdmin
			- `--key admin.key`
			- `--cert admin.crt`

- KubeConfig File
	- kube config 파일은 YAML 형식이다.
	- 클러스터, 컨텍스트, 사용자 3가지 섹션이 존재한다. 각각은 배열 형식이기에 각 섹션별로 여러 개를 지정할 수 있다.
	- kubeconfig 파일은 다른 오브젝트들처럼 `kubectl create`할 필요가 없다. `kubectl`이 매 실행마다 해당 파일을 참조할 뿐이다.
	- 클러스터와 사용자 섹션에는 인증서-키 쌍의 위치를 명시한다. 이 때, 절대 경로를 사용하는 것을 권장한다.
		- 인증서의 내용을 직접 기입하는 것도 가능하다. 이 때, Base64 인코딩한 값으로 작성해야 한다. 
			- `certidicate-authority-data: `
```yaml
apiVersion: v1
kind: config

# 여러 컨텍스트가 존재할 때, 현재 사용할 컨텍스트를 지정할 수 있다.
currnet-context: my-kube-config@my-kubernetes 

clusters:
- name: my-kuberentes
  cluster:
    certificate-authority: /etc/kubernetes/pki/ca.crt
    server: https://my-kuberentes:6443

contexts:
- name: my-kube-admin@mu-kuberentes
  context:
    cluster: my-kubernetes
    user: my-kube-admin

users:
- name: my-kube-admin
  user:
    client-certificate: /etc/kubernetes/pki/admin.crt
    client-key: /etc/kubernetes/pki/admin.key
```

- `kubectl`을 통해서 `kubeconfig` 파일 확인이 가능하다.
```bash
kubectl config view
```

- 여러 kubeconfig 파일이 존재할 때, 특정 kubeconfig 파일을 사용하도록 옵션을 통해 지정할 수 있다.
```bash
kubectl config view --kubeconfig=my-custom-config
```

- `kubectl`을 통해서 현재 컨텍스트를 변경할 수 있다. 해당 내용은 kubeconfig 파일의 `current-context`에 자동으로 업데이트 된다.
```bash
kubectl config use-context prod-user@production
```

- kubeConfig 파일의 context 섹션에 특정 네임스페이스를 지정할 수 있다. 그러면 해당 컨텍스트로 전환할 때, 해당 클러스터의 특정 네임스페이스로 전환된다.
```yaml
apiVersion:v1
kind: config
...

context:
- name: ...
  context: ...
    cluster: ...
    user: ...
    namespace: fianace
...
```